{% extends 'mydidata/base.html' %}

{% block content %}
    {% load question_extras %}
    {% load answer_extras %}
    {% load classroom_extras %}
    {% load test_extras %}
    <div id="content-container" class="container p-none">
		{% if classroom %}
			<h1>{{classroom.name}}</h1>
		{%endif%}
        
            <h2>{{test.title}}</h2>
            
            <table id="cd-table" class="table table-hover">

                <tbody>
                    <tr>
                        <th>Aluno</th>
                        
                        {%for question in test.get_ordered_questions %}
                            <th>{{question.text_escaped}}</th>
                        {% endfor %}
                    </tr>
                    {% for student in students%}
                        {%get_test_user student_grades student as test_user%}
                        <tr>
                            <td>{{student}}</td>
                            
                            {%for question in test.get_ordered_questions %}
                                
                                {% get_answers question student test as answers%}
                                
                                {%if answers%}
                                    {%for answer in answers%}
                                        <td>
                                            {% get_icon_class answer student as url_and_icon_class%}
                                            <a href="{{url_and_icon_class.0}}"><i style="{{url_and_icon_class.1}}" class="{{url_and_icon_class.2}}"></i></a>
                                        </td>
                                        
                                    {%endfor%}
                                {%else%}
                                    <td><span class="badge">?</span></a><br></td>
                                {%endif%}
                            {%endfor%}
                        </tr>
                    {%endfor%}
                </tbody>
            </table>
        
            
            {%if user.is_superuser%}
                <h1>Aproveitamento</h1>
                <table id="cd-table" class="table table-hover">
                    
                    <tbody>
                        <tr>
                            <th>Aluno</th>
                            <th>Nota</th>
                        </tr>
                        {% for student, student_status in student_grades.items %}                    
                            <tr>
                            <td>{{student.first_name}}&nbsp{{student.last_name}}</td>
                            <td>{{student_status.grade}}</td>
                            </tr>
                        {%endfor%}
                        
                    </tbody>
                </table>

                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                    Lançar no Acadêmico
                </button>
                      
                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Acesso do Acadêmico</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
        
                        <div class="modal-body">
                            
                            <form id="login-form" method="post" 
                                    action="/mydidata/test_to_academico/{{classroom.id}}/{{test.uuid}}/">
                                {% csrf_token %}
                                <table class="table">
                                    <tr>
                                        <td><label for="username">Nome de Usuário</label></td>
                                        <td><input id="username" name="username" 
                                                    type="text" class="form-control"></td>
                                    </tr>
                                    <tr>
                                        <td><label for="password">Senha</label></td>
                                        <td><input id="password" name="password" 
                                                    type="password" class="form-control"></td>
                                    </tr>
                                
                                </table>
                                <div class="form-group">
                                    <label for="etapa">Selecione a etapa para o lançamento</label>
                                    <select class="form-control-sm" id="etapa" name="etapa">
                                        <option>1BIM</option>
                                        <option>2BIM</option>
                                        <option>3BIM</option>
                                        <option>4BIM</option>                                  
                                    </select>
                                    </div>
                                {% if form.errors %}
                                    <p class=" label label-danger">
                                        O login e a senha não combinam.                        
                                    </p>                    
                                {% endif %}
                
                                <input type="submit" value="Login" 
                                        class="btn btn-primary pull-right" />
                                
                                
                            </form>
                            
        
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                        </div>
                        </div>
                    </div>
                </div>        
        
    
            {%else%}
                
                {% for student, student_status in student_grades.items %}
                    <h1>Aproveitamento: {{student_status.grade}}</h1>
                    <h2> <a href="{{test.topic.get_absolute_url}}"> Clique para retornar</a></h2>
                    
                    {%if student_status.grade >= 6%}
                        <div class="alert alert-success">
                            {{assessment.success}}
                        </div>
                    {%else%}
                        <div class="alert alert-danger" role="alert">
                            {%if student_status.next_try_link%}
                                Você pode tentar mais uma vez clicando <a href="{{student_status.next_try_link}}" class="alert-link">aqui!</a\>!
                            {%endif%}
                        </div>

                    {%endif%}
                {%endfor%}

            {%endif%}

    </div>

{% endblock %}
